<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Login</title>
  <!-- Importa o Bootstrap 5 para estilização -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container mt-5">
    <!-- Card de Login -->
    <div class="card shadow p-4">
      <h2 class="text-center mb-4">Login</h2>
      <div class="mb-3">
        <input type="text" class="form-control" id="login-username" placeholder="Usuário">
      </div>
      <div class="mb-3">
        <input type="password" class="form-control" id="login-password" placeholder="Senha">
      </div>
      <button class="btn btn-primary w-100 mb-2" onclick="login()">Entrar</button>
      <button class="btn btn-outline-secondary w-100" onclick="mostrarCadastro()">Cadastrar</button>
    </div>


      <!-- Card de Cadastro -->
      <div id="cadastro-container" class="card shadow p-4 mt-4 d-none">
      <h2 class="text-center mb-4">Cadastrar</h2>
      <div class="mb-3">
        <input type="text" class="form-control" id="register-username" placeholder="Usuário">
      </div>
      <div class="mb-3">
        <input type="password" class="form-control" id="register-password" placeholder="Senha">
      </div>
      <div class="mb-3">
        <select class="form-select" id="register-role">
          <option value="user">Usuário</option>
          <option value="admin">Administrador</option>
        </select>
      </div>
      <button class="btn btn-success w-100" onclick="cadastrar()">Cadastrar</button>
    </div>
  </div>


    </div>
  </div>

  <script>
    const API_URL = 'http://127.0.0.1:8000'; // URL base da API

    async function login() {
      // Pega os valores digitados nos campos de login
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      // Faz requisição para login na API
      const res = await fetch(`${API_URL}/autenticar/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();
      if (res.ok) {
        alert("Login realizado com sucesso!");
        localStorage.setItem("token", data.access_token); // Armazena token
        localStorage.setItem("role", data.role); // Armazena papel (user/admin)
        window.location.href = 'metricas.html'; // Redireciona para painel
      } else {
        alert(data.detail || "Erro no login");
      }
    }

    async function cadastrar() {
      // Pega os valores digitados nos campos de cadastro
      const username = document.getElementById("register-username").value;
      const password = document.getElementById("register-password").value;
      const role = document.getElementById("register-role").value;

      // Faz requisição para cadastro na API
      const res = await fetch(`${API_URL}/autenticar/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password, role })
      });

      const data = await res.json();
      if (res.ok) {
        alert(data.message);
      } else {
        alert(data.detail || "Erro no registro");
      }
    }


    // Mostra ou esconde o formulário de cadastro
    function mostrarCadastro() {
      const cadastro = document.getElementById("cadastro-container");
      cadastro.classList.toggle("d-none");
    }


  </script>

  <!-- Importa scripts JS do Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
